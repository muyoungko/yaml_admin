login:
  jwt-secret: ${JWT_SECRET}
  password-encoding: sha512 # bcrypt, sha512, sha256
  id-password:
    entity: admin
    id-field: email 
    password-field: password
api-host: 
  uri: http://localhost:6911
web-host: 
  uri: http://localhost:6900
database:
  mongodb: 
    uri: ${MONGODB_URL}
upload:
  s3:
    access_key_id: ${S3_ACCESS_KEY_ID}
    secret_access_key: ${S3_SECRET_ACCESS_KEY}
    region: ${S3_REGION}
    prefix: ${S3_PREFIX}
    bucket: ${S3_BUCKET}
    bucket_private: ${S3_BUCKET_PRIVATE}
    base_url: ${S3_BASE_URL}
  # local:
  #   path: ./upload
  #   path_private: ./upload_private
  #   base_url: http://localhost:6911
entity:
  server:
    category: '공장 관리'
    icon: "solar:buildings-3-outline"
    label: "공장"
    crud:
      search:
        - name: id
        - name: region
          exact: false
        - name: factory
          exact: false
      list: true
      create: true
      edit: true
      show: true
      delete: true
    fields:
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: region
        label: "지역"
        type: string
        required: true
      - name: factory
        label: "공장명"
        type: string
        required: true
  floor:
    category : '공장 관리'
    icon: "solar:map-outline"
    label: "도면"
    crud:
      search:
        - name: server_id
        - name: id
        - name: name
      list: true
      create: true
      edit: true
      show: true
      delete: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: region_id
        label: "개소"
        type: reference
        reference_entity: region
        reference_match: id
        reference_format: ${name}(${id})
        required: true
      - name: image
        label: "도면"
        type: image
        private: true
  region:
    category : '공장 관리'
    label: '개소'
    icon: "solar:download-square-outline"
    crud:
      search:
        - name: server_id
        - name: parent_id
        - name: name
      list: 
        - name: id
        - name: parent_id
        - name: name
        - name: seq
      create: true
      edit: true
      show: true
      delete: true
      export:
        fields:
          - name: server_id
          - name: parent_id
          - name: id
          - name: name
          - name: seq
      import:
        fields:
          - name: server_id
          - name: parent_id
          - name: id
          - name: name
          - name: seq
        upsert: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: parent_id
        label: "부모 장소"
        type: reference
        reference_entity: region
        reference_match: id
        reference_name: name
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: name
        label: "이름"
        type: string
        required: true
      - name: seq
        label: "순서"
        type: integer
  item:
    category : '공장 관리'
    label: '항목'
    icon: "solar:download-twice-square-outline"
    layout:
      left:
        - component: tree
          entity: region
          key: id
          parent_key: parent_id
          argment:
            - name: id
          sort:
            - name: seq
              desc: false
          label: name
          peer_click:
            action:
              - type: body
                crud : list
                entity: item
                filter:
                  - name: region_id
                    value: $arg0
                sort:
                  - name: seq
                    desc: false
    crud:
      search:
        - name: server_id
        - name: region_id
        - name: id
        - name: name
      list: 
        - name: region_id
        - name: id
        - name: name
        - name: seq
        - name: place_id
        - name: ils.id
      create: true
      edit: true
      show: true
      delete: true
      export:
        fields:
          - name: server_id
          - name: region_id
          - name: id
          - name: name
          - name: seq
      import:
        fields:
          - name: server_id
          - name: region_id
          - name: id
          - name: name
          - name: seq
        upsert: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: region_id
        label: "개소"
        type: reference
        reference_entity: region
        reference_match: id
        reference_name: name
        required: true
      - name: name
        label: "이름"
        type: string
        required: true
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: seq
        label: "순서"
        type: integer
      - name: place_id
        label: "Location"
        type: reference
        reference_entity: place
        reference_match: id
        reference_name: id
      - name: ils.id
        label: "잠금"
        type: reference
        reference_entity: ils
        reference_match: id
        reference_name: key
    api_generate:
      place_id:
        match_from: id
        entity: place
        match: item_id
        field: id
        single: true
      ils:
        match_from: place_id
        entity: ils
        match: place_id
        fields:
          - name: id
          - name: key
        single: true
  place:
    category: '공장 관리'
    label: 'Location'
    icon: "solar:download-minimalistic-bold-duotone"
    # hidden: true
    crud:
      search:
        - name: server_id
        - name: item_id
        - name: id
      list: 
        - name: server_id
        - name: item_id
        - name: id
      create: true
      edit: true
      show: true
      delete: true
      export:
        fields:
          - name: server_id
          - name: id
          - name: seq
      import:
        fields:
          - name: server_id
          - name: id
          - name: seq
        upsert: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: item_id
        label: "항목"
        type: reference
        required: true
        reference_entity: item
        reference_match: id
        reference_name: name
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
  member:
    category : '사용자 관리'
    icon: "solar:user-hands-outline"
    label: "사용자"
    crud:
      search:
          - name: server_id
          - name: email
            exact: false
          - name: name
            exact: false
      export:
        fields:
          - name: server_id
          - name: member_no
          - name: email
          - name: name
          - name: user_type
          - name: pass
          - name: phone
          - name: department_id
      import:
        fields:
          - name: server_id
          - name: member_no
          - name: email
          - name: name
          - name: user_type
          - name: pass
          - name: phone
          - name: department_id
        upsert: true
      list: true
      create: true
      edit: true
      show: true
      delete: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: member_no
        label: "회원번호"
        type: string
        required: true
        key: true
        autogenerate: true
      - name: email
        label: "로그인아이디"
        type: string
        required: true
      - name: name
        label: "이름"
        type: string
        required: true
      - name: pass
        label: "비밀번호"
        type: password
        required: true
      - name: user_type
        type: select
        label: "역할"
        select_values:
          - name: "관리자"
            label: "관리자"
          - name: "작업자"
            label: "작업자"
        required: true
      - name: phone
        type: string
        label: "전화번호"
        required: true
      - name: department_id
        label: "부서"
        type: reference
        reference_entity: department
        reference_match: id
        reference_name: name
        required: true
      - name: company
        label: "회사"
        type: string
  department:
    category : '사용자 관리'
    icon: "solar:city-outline"
    label: "부서"
    crud:
      search:
          - name: server_id
          - name: name
            exact: false
      list: true
      create: true
      edit: true
      show: true
      delete: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: name
        label: "이름"
        type: string
        required: true
              
  ils:
    category : '자원 관리'
    icon: "solar:lock-keyhole-minimalistic-outline"
    label: "ILS"
    crud:
      search:
        - name: id
        - name: server_id
        - name: key
        - name: serial
      list:
        - name: id
        - name: key
        - name: version
        - name: serial
        - name: item.item_id
        - name: lock_list
          label: "잠금자수"
        - name: lock_list.member_no
          label: "잠금자"
        - action: lock_history_popup
          argument: 
            field: id
      create:
        - name: server_id
        - name: key
        - name: serial
        - name: version
          default: 2
        - name: battery
      edit: 
        - name: server_id
        - name: key
        - name: serial
        - name: version
        - name: battery
      show: 
        - name: server_id
        - name: id
        - name: key
        - name: serial
        - name: version
        - name: battery
        - name: sync_date
        - name: item_id
        - name: lock_list
      delete: true
      export:
        fields:
          - name: id
          - name: server_id
          - name: key
          - name: serial
          - name: version
      import:
        fields:
          - name: id
          - name: server_id
          - name: key
          - name: serial
          - name: version
        upsert: true
    fields:
      - name: server_id
        label: "공장"
        type: reference
        reference_entity: server
        reference_match: id
        reference_name: factory
        required: true
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: key
        label: "태그"
        type: string
        required: true
      - name: serial
        label: "시리얼"
        type: string
        required: true
      - name: version
        label: "버전"
        type: string
        required: true
      - name: battery
        label: "배터리"
        type: string
      - name: sync_date
        label: "동기화"
        type: date
      - name: item.item_id
        label: "잠금 위치"
        type: reference
        reference_entity: item
        reference_match: id
        reference_name: name
      - name: lock_list
        label: "잠금목록"
        type: array
        fields:
          - name: member_no
            label: "잠금자"
            type: reference
            reference_entity: member
            reference_match: member_no
            reference_name: name
            reference_format: ${name}(${user_type})
          - name: reg_date
            label: "잠금일시"
            type: date
            showtime: true
    api_generate:
      item:
        match_from: place_id
        entity: place
        match: id
        fields: 
          - name : item_id
        single: true
      lock_list:
        match_from: id
        entity: lock
        match: ils_id
        fields: 
          - name : member_no
          - name : reg_date
  lock:
    hidden: true
    crud:
      search:
        - name: key
      list: true
    fields:
      - name: ils_id
        label: "ILS"
        type: reference
        reference_entity: ils
        reference_match: ils_id
        reference_name: key
      - name: member_no
        label: "잠금자"
        type: reference
        reference_entity: member
        reference_match: member_no
        reference_name: name
      - name: reg_date
        label: "잠금일"
        type: date
  lock_history:
    category: '자원 관리'
    label: "잠금이력"
    icon: "solar:history-outline"
    # hidden: true
    crud:
      search:
        - name: ils_id
      list: true
    fields:
      - name: ils_id
        label: "ILS"
        type: reference
        reference_entity: ils
        reference_match: id
        reference_name: key
      - name: member_no
        label: "잠금자"
        type: reference
        reference_entity: member
        reference_match: member_no
        reference_name: name
      - name: reg_date
        label: "잠금일"
        type: date
        showtime: true
      - name: lock
        label: "잠금/해제"
        type: boolean
  file:
    category: '파일 관리'
    icon: "solar:file-check-outline"
    label: "파일"
    crud:
      search:
        - name: id
        - name: attach
          exact: false
      list:
        - name: id
        - name: attach
        - name: create_date
      create: 
        - name: attach
      edit:
        - name: attach
      show: 
        - name: id
        - name: attach
        - name: create_date
      delete: true
    fields:
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: attach
        label: "파일"
        type: file
        required: true
        private: true
      - name: create_date
        label: "등록일"
        type: date
        showtime: true
  admin:
    category: '사용자 관리'
    icon: 'solar:shield-user-outline'
    label: '운영자'
    crud:
      search:
        - name: email
        - name: name
      list: true
      create: true
      edit: true
      show: true
      delete: true
    fields:
      - name: id
        label: "ID"
        type: integer
        required: true
        key: true
        autogenerate: true
      - name: email
        label: "이메일"
        type: string
        required: true
      - name: name
        label: "이름"
        type: string
        required: true
      - name: password
        label: "비밀번호"
        type: password
        required: true
front:
  dashboard:
    - component: chart
      id: lock_history1
      label: '잠금/해제 이용횟수'
      type: line
      size: 12
      height: 300
      x:
        label: '날짜'
        type: date
        entity: lock_history
        field: reg_date
        format: 'MM/DD'
        gap: day
        limit: 7
        timezone: Asia/Seoul
        desc: false
      y:
        series:
          - label: '잠금'
            if: lock==true
            color: '#8B0000' #red
          - label: '해제'
            if: lock!=true
            color: '#228B22' #green

    - component: chart
      id: lock_by_region
      label: '상위 개소별 잠금 현황'
      type: bar
      size: 12
      debug: true
      relation:
        chain:
          - match_from: ils_id
            entity: ils
            match: id
          - match_from: ils.place_id
            entity: place
            match: id
          - match_from: place.item_id
            entity: item
            match: id
          - match_from: item.region_id
            entity: region
            match: id
          - match_from: member_no
            entity: member
            match: member_no
        match:
            x: id
            with: region.parent_id

      x:
        label: '지역'
        type: field
        entity: region
        field: name
        if: parent_id==null
        sort:
          - name: seq
            desc: false
      y:
        entity: lock
        series:
          - label: '작업자 잠금'
            color: '#1a66cc' #blue
            if: member.user_type==작업자
          - label: '관리자 잠금'
            color: '#228B22' #green
            if: member.user_type==관리자

    - component: chart
      id: lock_by_member
      label: '사용자 타입 별 잠금 현황'
      type: bar
      size: 6
      relation_chain_y_to_x:
        - match_from: member_no
          entity: member
          match: member_no
      x:
        label: '사용자 타입'
        type: field
        entity: member
        field: user_type
      y:
        entity: lock
        series:
          - label: '잠금'
    
    - component: chart
      id: member_type
      label: '사용자 타입'
      type: bar
      size: 6
      x:
        label: '사용자 타입'
        type: field
        entity: member
        field: user_type
      y:
        entity: member
        series:
          - label: '사용자'
            color: '#1a66cc'
  category:
    - name: '공장 관리'
      icon: 'material-symbols:factory-outline'
    - name: '자원 관리'
      icon: 'solar:lock-keyhole-minimalistic-outline'
    - name: '사용자 관리'
      icon: 'solar:user-hands-outline'
    - name: '파일 관리'
      icon: 'solar:file-check-outline'

  
